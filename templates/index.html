{% extends "base.html" %}

{% block content %}
<h2>Job List</h2>
{% if current_user.is_authenticated %}
    <a href="{{ url_for('add_job') }}" class="btn btn-primary mb-3">Add Job</a>
{% endif %}
<table class="table table-striped">
    <thead>
        <tr>
            <th>ID</th>
            <th>Job Description</th>
            <th>Team Leader</th>
            <th>Work Size (hours)</th>
            <th>Collaborators</th>
            <th>Categories</th>
            <th>Finished</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for job in jobs %}
        <tr>
            <td>{{ job.id }}</td>
            <td>{{ job.job }}</td>
            <td>{{ users.get(job.team_leader, 'N/A') }}</td>
            <td>{{ job.work_size }}</td>
            <td>{{ job.collaborators }}</td>
            <td>
                {% for category in job.categories %}
                    <span class="badge bg-secondary">{{ category.name }}</span>
                {% endfor %}
            </td>
            <td>{{ 'Yes' if job.is_finished else 'No' }}</td>
            <td>
                {% if current_user.is_authenticated %}
                    {% if job.team_leader_user == current_user or current_user.id == 1 %}
                        <a href="{{ url_for('edit_job', job_id=job.id) }}" class="btn btn-sm btn-outline-primary">Edit</a>
                        <a href="{{ url_for('delete_job', job_id=job.id) }}" class="btn btn-sm btn-outline-danger" onclick="return confirm('Are you sure you want to delete this job?')">Delete</a>
                    {% endif %}
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}